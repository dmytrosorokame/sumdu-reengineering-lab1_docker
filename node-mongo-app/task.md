Веб-додаток

У веб-додатку написано лише найстрашнішу технологію Rockstar, Node.js. Як базу даних додаток використовує найбільш масштабну, надійну та стійку базу даних, доступну на сьогоднішній день, MongoDB.

Веб-додаток можна знайти на GitHub. Зверніть увагу, що веб-програма прослуховує порт 8080, тож вам потрібно буде переадресувати цей порт. Не забудьте дозволити його на своєму брандмауері (в Linux, ufw allow 8080). Інструкції з його налаштування знаходяться в README.md сховища: https://github.com/0xcf/decal-sp18-a10

Для MongoDB ви можете просто використовувати образ на DockerHub (веб-сайт, куди люди можуть завантажувати зібрані образи Docker). Він там називається просто mongo. Наприклад, якщо ви хочете запустити MongoDB всередині контейнера у відокремленому режимі, то можна використати таку команду:

docker run -d mongo:latest
Об’єднаємо їх разом

Ваше завдання – використовувати docker-compose для розгортання програми Node.js із базою даних MongoDB. Ми пропонуємо приблизно такий порядок задач:

написати Dockerfile, що дозволить запустити Node.js веб-додаток;
написати docker-compose.yml файл, що склеїть контейнер Node.js додатку з контейнером MongoDB.
Ось базовий скелет для docker-compose.yml. Вам потрібно буде заповнити записи в web та database:

version: '3'
services:
web:
database:
За замовчуванням веб-додаток Node.js розроблено для пошуку екземпляра MongoDB у з хост-іменем database, тому переконайтеся, що ваша служба MongoDB визначена під цим іменем. docker-compose перевіряє, що хостове ім’я database відображається у контейнері для цієї служби.

Одне величезне застереження: розробник програмного забезпечення, на жаль, написав додаток Node.js безглуздо, коли, якщо він не зможе підключитися до бази даних MongoDB після його запуску, він вийде з ладу та вийде без повторної спроби. Оскільки Javascript отрута, вам потрібно буде знайти спосіб переконатися, що програма Node.js запускається лише після того, як контейнер MongoDB готовий приймати вхідні з'єднання без зміни server.js. До репозиторію програми Node.js включено wait-for скрипт, що дозволить вам дочекатися готовності служби MongoDB перед запуском програми Node.js. Але для того, щоб використовувати скрипт, вам потрібно встановити netcat у вашому контейнері, тому обов’язково включіть його у свій Dockerfile. Інструкції щодо використання сценарію дивіться тут. Не соромтеся придумувати інші способи вирішення цієї проблеми!

Швидше за все, посилання Compose File Reference буде корисним. Крім того, допоможе також посібник Getting Started, хоча це приклад python замість чудового Node.js, я також пропоную роздивитись інші документи на цьому сайті. Я очікую, що ви зіткнетеся з помилками та труднощами – це передбачено, як частина лабораторної роботи. Будь ласка, спробуйте погуглити повідомлення про помилки та придумати власні виправлення.

Підказки (якщо ви їх хочете):

Node.js Dockerfile, я рекомендую основувати на ubuntu:xenial та встановити все необхідне (nodejs, npm, etc.) через apt. Їх немає у сховищі Debian’s apt, тому вам доведеться знайти інший спосіб встановити їх, якщо ви використовуєте Debian.
npm install потрібно запускати в каталозі, що містить сховище (тобто потрібно запускати в каталозі, що містить файл package.json file). Якщо ви хочете змінити поточний робочий каталог у своєму Dockerfile, використовуйте WORKDIR command
Якщо ви змінили свій Dockerfile після запуску docker-compose up, вам потрібно буде запустити docker-compose build щоб відновити свої служби
Після того, як ви все налаштуєте належним чином, просто запустивши docker-compose up у тому ж каталозі, що і файл docker-compose.yml, відкриється ваша веб-програма!
